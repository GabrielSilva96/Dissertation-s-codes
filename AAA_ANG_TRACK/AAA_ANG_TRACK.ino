// Thesis: Modeling of artificial muscles made of nylon wire 
// Author: Gabriel Silva - 82084 - MEEC - IST Lisbon - 2018/2019 
// Description: Verification tests upon the AAA: angle tracking performance

// Define inputs
#define PWM_PIN 3
#define PWM_PIN_ANTA 9

unsigned long curr_t;
int i = 0;
int pwm_val_ag;
int pwm_val_aa;
//SINE WAVE LOOKUP TABLE
int pwm_ag[401] = {0,105,125,142,154,159,168,170,176,179,182,185,187,190,192,194,195,195,197,197,197,197,197,197,196,195,194,193,192,191,189,188,187,185,183,181,180,178,176,174,172,170,167,165,163,160,158,155,153,150,148,145,142,139,136,132,129,126,123,119,116,112,109,106,102,99,95,91,88,84,81,77,73,69,66,61,57,53,47,43,37,30,21,5,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,4,5,4,2,6,10,14,19,23,28,32,36,41,45,49,53,57,61,65,69,73,77,80,84,87,90,94,97,100,103,106,109,111,114,116,119,122,124,126,129,131,133,135,137,139,142,144,146,147,149,151,153,155,157,159,160,162,164,165,167,169,170,172,173,175,176,178,179,180,181,183,184,185,186,187,188,189,190,191,191,192,193,193,194,194,195,195,195,196,196,196,196,196,197,197,197,196,196,196,196,196,195,195,195,194,194,193,192,192,191,190,190,189,188,187,186,185,184,183,181,180,179,177,176,174,173,171,170,168,166,164,163,161,159,157,155,153,151,149,147,145,143,141,138,136,134,132,129,127,124,122,119,117,114,112,110,107,104,102,99,96,93,91,88,85,82,79,76,73,70,67,64,61,58,54,51,48,45,41,38,34,30,27,22,18,12,5,4,5,5,5,5,6,5,5,7,9,12,15,18,20,23,26,29,32,35,38,42,44,48,51,54,57,60,63,66,69,72,75,77,80,83,86,89,92,95,98,100,103,106,109,111,114,116,119,121,124,126,129,131,133,136,138,140,142,144,147,149,151,153,155,157,158,160,162,164,166,167,169,171,172,174,175,176,178,179,181,182,183,184,185,186,187,188,189,190,191,192,193,194,194
};
int pwm_aa[401] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,20,38,46,55,62,69,75,80,85,90,94,98,102,106,109,112,115,118,121,123,126,128,130,132,134,136,138,140,141,143,145,146,148,149,151,152,154,155,156,158,159,161,162,163,165,166,168,169,170,172,173,175,176,177,179,180,182,183,184,185,186,187,188,189,190,191,191,192,193,193,193,194,194,194,194,193,193,193,192,192,191,190,189,188,187,186,185,184,182,181,179,178,176,175,173,171,169,168,166,164,162,160,158,156,155,153,151,149,147,145,143,141,139,136,134,132,130,128,126,123,121,118,116,113,111,108,106,104,101,98,95,92,89,86,83,80,77,74,71,68,64,61,57,54,50,46,43,39,35,30,24,20,12,4,2,2,3,4,4,4,5,5,5,7,6,6,8,10,13,16,18,21,24,27,30,33,36,39,42,45,48,51,54,58,61,64,67,70,73,76,79,82,85,88,91,94,96,99,102,105,107,110,113,115,118,120,123,125,128,130,133,135,137,139,142,144,146,148,150,152,154,156,158,160,161,163,165,166,168,170,171,173,174,176,177,179,180,181,182,184,185,186,187,188,189,190,191,191,192,193,193,194,195,195,196,196,197,197,197,197,198,198,198,198,198,198,198,198,197,197,197,196,196,196,195,194,194,193,193,192,191,190,189,188,187,186,185,184,183,182,181,179,178,176,175,173,172,170,169,167,165,163,162,160,158,156,154,152,150,148,146,144,142,139,137,135,133,130,128,125,123,121,118,116,113,110,108,105,103,100,97,94,92,89,86,83,80,78,75,72,69,66,63,60,57,53,50,47,44,41,38
};

//MULTILVEL RANDOM SIGNAL LOOKUP TABLE
/*
int pwm_ag[438] = {254,217,181,174,159,149,137,126,119,112,111,110,112,115,118,121,123,124,124,123,122,120,118,115,114,112,112,112,112,113,114,115,115,116,116,116,115,115,115,114,114,114,114,114,114,114,114,115,115,115,115,115,115,114,116,113,115,113,114,115,110,124,61,9,5,1,1,0,3,60,101,118,130,131,129,121,111,100,89,82,78,81,86,94,101,108,113,116,117,117,115,112,109,107,104,103,103,104,105,106,108,109,110,110,110,110,109,109,108,107,107,107,107,107,107,107,108,108,107,109,105,111,103,113,97,14,6,5,1,0,33,83,101,115,122,121,119,111,103,93,85,80,78,81,85,91,97,102,105,107,108,107,106,104,101,99,98,97,97,97,98,99,101,102,102,103,102,102,102,101,100,100,100,100,100,100,100,99,102,100,103,100,102,101,99,106,87,173,266,250,255,245,225,208,182,164,144,135,133,139,149,160,171,178,183,184,182,179,173,167,162,157,154,153,154,156,159,162,164,166,167,167,166,165,164,163,161,161,160,160,161,161,162,163,163,164,164,164,164,162,164,162,162,163,161,164,160,166,159,171,243,260,251,252,236,225,208,195,184,176,176,177,183,189,196,201,205,206,206,204,200,197,193,190,188,187,188,189,190,192,194,195,196,196,195,195,194,193,192,192,192,192,192,192,192,193,193,194,194,194,193,193,194,192,195,191,194,192,192,195,186,208,104,19,48,110,137,165,179,195,199,202,199,192,185,176,169,164,161,162,165,170,174,179,183,185,186,185,184,182,180,178,176,175,175,175,176,177,178,179,180,180,180,180,180,179,178,178,178,178,178,178,178,177,179,178,179,179,178,181,175,183,171,186,162,24,10,10,8,22,83,126,148,167,176,178,176,169,160,149,140,134,131,132,135,141,148,153,158,161,162,162,160,158,155,153,151,150,150,150,151,152,153,155,156,156,156,156,155,155,154,153,153,153,153,153,153,153,154,154,154,154,154,154,154,154,154,154
};
int pwm_aa[438] = {0,0,0,0,0,0,1,2,17,42,47,48,42,34,17,0,0,0,0,1,1,8,24,33,38,42,44,44,42,41,38,35,33,32,31,32,33,34,36,37,38,39,39,38,38,37,36,35,35,35,35,35,34,37,34,38,34,38,36,34,44,19,139,272,242,232,218,199,185,162,147,129,120,117,120,129,136,146,152,156,158,157,154,149,144,139,135,133,132,132,134,136,138,140,142,143,143,143,142,141,139,138,138,137,137,138,138,139,139,140,140,140,140,140,139,140,139,139,140,138,142,136,143,135,149,241,256,226,222,206,197,183,172,164,158,159,161,166,171,177,181,183,184,183,181,178,175,172,170,168,168,168,170,171,172,173,174,175,175,175,174,173,173,172,172,172,172,172,172,172,173,173,173,173,173,173,173,173,172,175,171,175,171,173,174,166,187,91,11,4,2,2,10,74,128,147,170,174,177,173,163,154,141,132,125,123,126,131,138,145,151,156,159,160,159,157,154,151,149,147,146,146,146,147,149,150,152,153,153,153,152,152,151,150,150,149,149,149,149,151,149,151,151,150,152,148,155,144,157,136,20,9,8,6,10,62,108,128,145,153,155,153,146,138,128,119,113,110,111,115,121,127,132,136,139,140,140,138,136,134,131,130,128,128,129,130,131,132,133,134,134,134,134,134,133,132,132,131,131,131,132,132,132,133,131,134,132,134,133,130,137,122,190,263,229,209,192,169,153,133,126,122,128,137,147,158,165,170,172,171,169,164,159,154,150,147,146,147,148,151,153,155,157,158,158,158,157,156,155,154,153,152,152,153,153,154,155,155,155,155,155,155,155,155,154,154,154,154,155,153,156,152,159,151,164,242,260,251,257,242,228,209,191,177,167,166,168,175,183,192,199,203,205,204,202,198,193,189,185,183,181,181,183,185,187,189,190,191,192,191,191,190,189,187,187,186,186,187,187,188,188,189,189,189,189,189,189,189,188,188,188,188,188,188,188,188,188,188
};
*/

void setup() { 
  Serial.begin(9600);
  pinMode(PWM_PIN, OUTPUT); 
  pinMode(PWM_PIN_ANTA, OUTPUT); 
}

void loop() 
{  
  if (i < 401) //401 SINE AND 438 MULTILVEL RANDOM
  {

  // TEST UPON THE AAA

  pwm_val_ag = pwm_ag[i];
  pwm_val_aa = pwm_aa[i];
  
  curr_t = millis();   
  Serial.print(curr_t);
  Serial.print("\t");
  Serial.print(pwm_val_ag);
  Serial.print("\t");
  Serial.println(pwm_val_aa);
  }
  else{
    Serial.println("END"); 
    Serial.end();
  }
  i += 1;
  
  analogWrite(PWM_PIN, pwm_val_ag);
  analogWrite(PWM_PIN_ANTA, pwm_val_aa); 
  
  delay(100); //100 SINE AND 320 MULTILEVEL RANDOM
}
